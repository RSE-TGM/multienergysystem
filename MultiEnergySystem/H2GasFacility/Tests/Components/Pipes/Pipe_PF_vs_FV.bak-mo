within MultiEnergySystem.H2GasFacility.Tests.Components.Pipes;
model Pipe_PF_vs_FV
  // Test to compare FV and PF pipes using the NG4_H2 model for both pipes
  extends Components.Pipes.TestSinglePipe_A(
    redeclare model Medium = H2GasFacility.Media.IdealGases.NG4_H2, n = 15, Xref = {0.94626, 0.0339757, 0.0105162, 0.0001, 0.0092477},
    roundPipe(
      X_start=Xref,
    Di =           Pipe.pipe1.Di,
    L =           Pipe.pipe1.L,
      Tin_start=288.15,
      Tout_start=288.15,
    rho_nom =           Pipe.pipe1.rho_nom,
    k =           Pipe.pipe1.k,
    m_flow_start =           Pipe.pipe1.m_flow_start,
    pin_start =           Pipe.pipe1.pin_start,
    pout_start =           Pipe.pipe1.pout_start),
    m_flow_start = Pipe.pipe1.m_flow_start,
    sourceP(
    p0(                                            displayUnit =            "Pa")=
                 Pipe.pipe1.pin_start, T0=288.15),
    p_in(
    height =      0.5e5*0.05, offset =      0.5e5),
    sink(                                                                         T0 =      15 + 273.15, p0 =      Pipe.pipe1.pout_start, pin_start =      Pipe.pipe1.pout_start,
      X0=Xref,                                                                                                                                                                                              G =      0),
    T_in(                                                                                                                                                                                                        duration =      10),
    m_flow(                                                                                                                                                                                                        duration =        10));
  MultiEnergySystem.H2GasFacility.Components.Pipes.PipePF pipePF
    annotation (Placement(transformation(extent={{-20,-72},{22,-32}})));
  MultiEnergySystem.H2GasFacility.Sources.SourcePressure
                                       sourceP1(
    p0(displayUnit="Pa") = Pipe.pipe1.pin_start,
    T0=15 + 273.15,
    redeclare model Medium = Medium,
    X0=Xref,
    use_in_T0=true,
    use_in_p0=true)                                                                                                                                         annotation (
    Placement(visible = true, transformation(origin={-50,-52},  extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  MultiEnergySystem.H2GasFacility.Sources.SinkMassFlow
                                     sink1(
    T0(displayUnit="K") = 15 + 273.15,
    p0=Pipe.pipe1.pout_start,
    pin_start=Pipe.pipe1.pout_start,
    X0=Xref,
    G=0,
    redeclare model Medium = Medium,
    m_flow0=m_flow_start,
    use_in_m_flow0=true)                                                                                                                                                                                     annotation (
    Placement(visible = true, transformation(origin={52,-52},  extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  Modelica.Blocks.Sources.Ramp m_flow1(
    duration=10,
    height=-m_flow_start*2,
    offset=m_flow_start,
    startTime=75)                                                                                                      annotation (
    Placement(visible = true, transformation(origin={74,-28},   extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  Modelica.Blocks.Sources.Ramp p_in1(
    height=0.5e5*0.05,
    offset=0.5e5,
    duration=50,
    startTime=200)                                                                                       annotation (
    Placement(visible = true, transformation(origin={-84,-48},   extent = {{-10, -10}, {10, 10}}, rotation = 0)));
  Modelica.Blocks.Sources.Ramp T_in1(
    duration=10,
    height=0,
    offset=15 + 273.15,
    startTime=150)                                                                                    annotation (
    Placement(visible = true, transformation(origin={-84,-18},   extent = {{-10, -10}, {10, 10}}, rotation = 0)));
equation
  connect(sourceP1.outlet, pipePF.inlet) annotation (Line(
      points={{-40,-52},{-20,-52}},
      color={182,109,49},
      thickness=0.5));
  connect(pipePF.outlet, sink1.inlet) annotation (Line(
      points={{22,-52},{42,-52}},
      color={182,109,49},
      thickness=0.5));
  connect(m_flow1.y, sink1.in_m_flow0) annotation (Line(points={{85,-28},{90,
          -28},{90,-14},{46,-14},{46,-47}}, color={0,0,127}));
  connect(p_in1.y, sourceP1.in_p0) annotation (Line(points={{-73,-48},{-66,-48},
          {-66,-38},{-54,-38},{-54,-43.6}}, color={0,0,127}));
  connect(T_in1.y, sourceP1.in_T0) annotation (Line(points={{-73,-18},{-50,-18},
          {-50,-42.4}}, color={0,0,127}));
  annotation (
    experiment(StartTime = 0, StopTime = 350, Tolerance = 1e-06, Interval = 0.070014));
end Pipe_PF_vs_FV;
